<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SpawnHub - Spawn Your Own Jupyter Container</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.4.0/stitch.js"></script>

    <script>

        const client = stitch.Stitch.initializeDefaultAppClient("mside-rqcve");

        if (client.auth.hasRedirectResult()) {
            client.auth.handleRedirectResult().then(user => {
                console.log(user);
            });
        }

        var errCt = 0;

        window.login = async function(){
            try {
                if (!client.auth.isLoggedIn) {
                    const credential = new stitch.GoogleRedirectCredential(window.location.origin);
                    client.auth.loginWithRedirect(credential);
                } else {
                    console.log(client.auth.currentUser);
                }
            }
            catch(e) {
                errCt++;
                console.log("try " + errCt);
                console.log(e);
                if(errCt < 5) {
                    setTimeout(function() { login();}, 500);
                }
            }
        }

        window.getCurrentUserName = async function() {
            return client.auth.currentUser.profile.name||"";
        }

        window.getCurrentUserIcon = async function() {
            return client.auth.currentUser.profile.pictureUrl||"/user.png";
        }

        window.getCurrentUser = async function() {
            return client.auth.currentUser.id;
        }

        window.getCurrentUserEmail = async function() {
            return (client.auth.currentUser.profile.email.replace("@","").replace(/\./g,"")||"UNKNOWNUNKNOWNUNKNOWN");
        }

    </script>
</head>

<body>
    <app>Loading...</app>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
</body>

</html>
